<div class="jcf-select-drop" id="{container}" style="display: none;">
    <div class="jcf-select-drop-content">
        <span class="jcf-list">
            <span class="jcf-list-content">
                <ul id="{list}" class="links-list">
                </ul>
            </span>
        </span>
    </div>
</div>
<style>
    #{container} {
        position: absolute;
        z-index: 1;
    }
    #{list} .jcf-option:hover {
        background: #e6e6e6;
    }
    #{list} .jcf-option-selected {
        background: #e6e6e6;
    }
</style>
<script type="{type}">

    var AutoCompleteInitialSettings = {
        <f:comment>wake up, fluid!</f:comment>
        inputId: '{inputId}',
        options: <f:format.htmlentitiesDecode>{options}</f:format.htmlentitiesDecode>,
        container: '{container}',
        list: '{list}'
    }

    var Autocomplete = {
        settings: {
            input: document.getElementById(AutoCompleteInitialSettings.inputId),
            options: AutoCompleteInitialSettings.options,
            autocomplete_container: document.getElementById(AutoCompleteInitialSettings.container),
            autocomplete_results: document.getElementById(AutoCompleteInitialSettings.list),
            currentFocus: -1
        },
        init: function() {
            this.bindEvents();
            this.setup();
        },
        setup: function() {
            this.settings.autocomplete_container.style.width = this.settings.input.offsetWidth + 'px';
        },
        bindEvents: function() {
            var self = this;

            this.settings.input.onkeyup = function(e) {
                var x = self.settings.autocomplete_container.getElementsByTagName("li");

                if (e.keyCode == 40) {
                    self.settings.currentFocus++;
                    self.setFocus(x);
                } else if (e.keyCode == 38) {
                    self.settings.currentFocus--;
                    self.setFocus(x);
                } else if (e.keyCode == 13) {
                    e.preventDefault();
                    //  prevent sending the form
                    if (self.settings.currentFocus > -1) {
                        //  simulate the click
                        if (x) x[currentFocus].click();
                    }
                } else {
                    self.findResults();
                }
            };

            this.settings.autocomplete_results.addEventListener('click', function(e) {
            self.settings.input.value = self.settings.options[e.target.dataset.autocompleteIndex];
            self.findResults();
        });
        },
        setFocus: function (x) {
            if (!x) return false;
            this.removeFocus(x);
            if (this.settings.currentFocus >= x.length) this.settings.currentFocus = 0;
            if (this.settings.currentFocus < 0) this.settings.currentFocus = (x.length - 1);
            x[this.settings.currentFocus].classList.add("jcf-option-selected");
        },
        removeFocus: function (x) {
            for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("jcf-option-selected");
            }
        },
        buildResults: function(val) {
            var resultSet = [],
                pattern = new RegExp(val, 'i');

            for (i = 0; i < this.settings.options.length; i++) {
                if (pattern.test(this.settings.options[i]) && this.settings.options[i] !== val) {
                    resultSet.push(i);
                }
            }

            return resultSet;
        },
        findResults: function() {
            var input_val = this.settings.input.value,
                resultSet = [];

            if (input_val.length > 0) {
                this.settings.autocomplete_results.innerHTML = '';
                resultSet = this.buildResults(input_val);
                for (i = 0; i < resultSet.length; i++) {
                    this.settings.autocomplete_results.innerHTML += '<li><span class="jcf-option" data-autocomplete-index="' + resultSet[i] + '">' + this.settings.options[resultSet[i]] + '</span></li>';
                }
                this.settings.autocomplete_container.style.display = (resultSet.length > 0) ? 'block' : 'none';
            } else {
                this.settings.autocomplete_results.innerHTML = '';
                this.settings.autocomplete_container.style.display = 'none';
            }
        }
    };

    Autocomplete.init();

</script>